# Captive Portal Site (see /var/www/captal/sites for examples)
#server.document-root = "/var/www/captal/sites/Adbepicentro_it.portal"
#server.document-root = "/var/www/captal/sites/Alice_it.portal"
#server.document-root = "/var/www/captal/sites/ARRIS_en.portal"
#server.document-root = "/var/www/captal/sites/ARRIS_es.portal"
#server.document-root = "/var/www/captal/sites/Asus_it.portal"
#server.document-root = "/var/www/captal/sites/Bbox_fr.portal"
#server.document-root = "/var/www/captal/sites/Belkin_en.portal"
#server.document-root = "/var/www/captal/sites/Belkin_it.portal"
#server.document-root = "/var/www/captal/sites/Cisco_it.portal"
#server.document-root = "/var/www/captal/sites/Cisco-Linksys_it.portal"
#server.document-root = "/var/www/captal/sites/Digicom_it.portal"
#server.document-root = "/var/www/captal/sites/Djaweb_fr.portal"
#server.document-root = "/var/www/captal/sites/Dlink_it.portal"
#server.document-root = "/var/www/captal/sites/Dlink_ru.portal"
#server.document-root = "/var/www/captal/sites/Freebox_fr.portal"
#server.document-root = "/var/www/captal/sites/FRITZBox1_en.portal"
#server.document-root = "/var/www/captal/sites/FRITZBox2_en.portal"
#server.document-root = "/var/www/captal/sites/FRITZBox_de.portal"
#server.document-root = "/var/www/captal/sites/GENENIX_de.portal"
#server.document-root = "/var/www/captal/sites/Google_de.portal"
#server.document-root = "/var/www/captal/sites/HUAWEI_en.portal"
#server.document-root = "/var/www/captal/sites/HUAWEI_it.portal"
#server.document-root = "/var/www/captal/sites/kpn_nl.portal"
#server.document-root = "/var/www/captal/sites/Livebox_fr.portal"
#server.document-root = "/var/www/captal/sites/movistar_es.portal"
#server.document-root = "/var/www/captal/sites/NETGEAR_en.portal"
#server.document-root = "/var/www/captal/sites/NETGEAR_es.portal"
#server.document-root = "/var/www/captal/sites/NETGEAR_it.portal"
#server.document-root = "/var/www/captal/sites/NETGEAR-Login_en.portal"
#server.document-root = "/var/www/captal/sites/Netis_it.portal"
#server.document-root = "/var/www/captal/sites/Proximus_fr.portal"
#server.document-root = "/var/www/captal/sites/Proximus_nl.portal"
#server.document-root = "/var/www/captal/sites/SFR_fr.portal"
#server.document-root = "/var/www/captal/sites/Sitecom_it.portal"
#server.document-root = "/var/www/captal/sites/Technicolor_en.portal"
#server.document-root = "/var/www/captal/sites/Technicolor_it.portal"
#server.document-root = "/var/www/captal/sites/Telecom_it.portal"
#server.document-root = "/var/www/captal/sites/Telekom_de.portal"
server.document-root = "/var/www/captal/sites/TP-LINK_en.portal"
#server.document-root = "/var/www/captal/sites/TP-LINK_it.portal"
#server.document-root = "/var/www/captal/sites/Verizon_en.portal"
#server.document-root = "/var/www/captal/sites/vodafone_es.portal"
#server.document-root = "/var/www/captal/sites/Xfinity-Login_en.portal"
#server.document-root = "/var/www/captal/sites/ziggo1_nl.portal"
#server.document-root = "/var/www/captal/sites/ziggo2_nl.portal"
#server.document-root = "/var/www/captal/sites/Zyxel_it.portal"

server.modules = (
    "mod_access",
    "mod_alias",
    "mod_accesslog",
    "mod_fastcgi",
    "mod_redirect",
    "mod_rewrite",
    #"mod_openssl", # Uncomment in case of using SSL (see below)
)

accesslog.filename = "/var/log/lighttpd.log"

fastcgi.server = (
    ".php" => (
        (
            "bin-path" => "/usr/bin/php-cgi",
            "socket" => "/tmp/php.socket"
        )
    )
)

server.port = 80
server.pid-file = "/var/run/lighttpd.pid"
# server.username = "www"
# server.groupname = "www"

mimetype.assign = (
    ".html" => "text/html",
    ".htm" => "text/html",
    ".txt" => "text/plain",
    ".jpg" => "image/jpeg",
    ".png" => "image/png",
    ".css" => "text/css"
)

server.error-handler-404 = "/"

static-file.exclude-extensions = (
    ".fcgi",
    ".php",
    ".rb",
    "~",
    ".inc"
)

index-file.names = (
    "index.htm",
    "index.html",
    "index.php"
)

# To enable SSL, run firstly captal-gencert, to generate the /etc/captal/server.pem.
# Then, uncomment these lines, add "mod_openssl" to server.modules list, declared above,
# and (re)start /etc/rc.d/captal-lighttpd.
#$SERVER["socket"] == ":443" {
#    ssl.engine = "enable"
#    ssl.pemfile = "/etc/captal/server.pem"
#}

################################################################################
# The following will emulate Apple's and Google's internet connectivity checks.#
# This should help with no-internet-connection warnings in some devices.       #
################################################################################

# Respond with Firefox' captive response.
$HTTP["host"] == "detectportal.firefox.com" {
    server.document-root = "/var/www/captal/sites/connectivity_responses/Firefox"
}

# Respond with Apple's captive response.
$HTTP["host"] == "captive.apple.com" {
    server.document-root = "/var/www/captal/sites/connectivity_responses/Apple/"
}

# Respond with Google's captive response on certain domains.
# Domains: www.google.com, clients[0-9].google.com,
# connectivitycheck.gstatic.com, connectivitycheck.android.com,
# android.clients.google.com, alt[0-9]-mtalk.google.com, mtalk.google.com
$HTTP["host"] =~ "((www|(android\.)?clients[0-9]*|(alt[0-9]*-)?mtalk)\.google|connectivitycheck\.(android|gstatic))\.com" {
    server.document-root = "/var/www/captal/sites/connectivity_responses/Google/"
    url.rewrite-once = ( "^/generate_204\$" => "generate_204.php" )
}
################################################################################

# Redirect all traffic to the captive portal when not emulating a connection.
$HTTP["host"] != "captive.gateway.lan" {
    url.redirect-code = 302
    url.redirect  = (
        "^/(.*)" => "http://captive.gateway.lan/",
    )
}

# vim:ft=perl:sw=4:ts=4:sts=4:et:cc=80
# End of file
